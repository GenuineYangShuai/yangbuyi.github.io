---
slug: 阿里巴巴nacos服务注册和发现
title: 阿里巴巴nacos服务注册和发现
author: 杨不易呀
author_title: Java开发工程师
author_url: https://github.com/GenuineYangshuai
author_image_url: https://tvax3.sinaimg.cn/crop.0.0.1080.1080.180/b2745d44ly8g8s4muqeggj20u00u0n0k.jpg?KID=imgbed,tva&Expires=1582389585&ssig=EvXmyu%2FXsX
description: 阿里巴巴nacos服务注册和发现 杨不易呀
tags: [后端]
---

####  接着上一次的nacos初步讲解和安装
####  任意门：https://www.cnblogs.com/Yangbuyi/p/13479767.html
####  如果启动失败的话 上一篇也是讲解过的.
![](https://img2020.cnblogs.com/blog/1735255/202008/1735255-20200816203446048-67588107.png)

<!-- truncate -->

####  本文章开始服务注册和发现
####  工程准备
#### 创建一个父模块将里面的src删除即可留下.idea和pox.xml文件
![](https://img2020.cnblogs.com/blog/1735255/202008/1735255-20200816203822741-448268306.png)


```

    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.2.3.RELEASE</version>
    </parent>

    <!-- 全局版本控制 -->
    <properties>
        <springCloud.version>Hoxton.SR7</springCloud.version>
        <springCloud-alibaba.version>2.1.1.RELEASE</springCloud-alibaba.version>
    </properties>

    <dependencyManagement>
        <dependencies>
            <!-- springCloud 版本控制 -->
            <dependency>
                <groupId>org.springframework.cloud</groupId>
                <artifactId>spring-cloud-dependencies</artifactId>
                <version>${springCloud.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>

            <!-- 阿里 版本库 依赖 -->
            <dependency>
                <groupId>com.alibaba.cloud</groupId>
                <artifactId>spring-cloud-alibaba-dependencies</artifactId>
                <version>${springCloud-alibaba.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
        </dependencies>

    </dependencyManagement>
```



####  创建consumer工程模块和provide工程模块(调用者、服务者)
![](https://img2020.cnblogs.com/blog/1735255/202008/1735255-20200816205303618-1288706969.png)







####  1.在consumer模块当中添加依赖

```java
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
        </dependency>
        <!-- 服务发现 nacos  -->
        <dependency>
            <groupId>com.alibaba.cloud</groupId>
            <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
        </dependency>
```



####  2. 手写启动类

![image-20200816205715463](C:\Users\16927\AppData\Roaming\Typora\typora-user-images\image-20200816205715463.png)

```

/**
 * @description: 杨不易网站:www.yangbuyi.top
 * @program: springcloudalibabaparent
 * @ClassName: AppConsumer
 * @create: 2020-08-16 20:57
 * @author: yangbuyi
 * @since： JDK1.8
 * @AppConsumer:
 **/
@SpringBootApplication
@Slf4j
// nacos 服务发现 客户端
@EnableDiscoveryClient

public class AppConsumer {

	  public static void main(String[] args) throws UnknownHostException {
			ConfigurableApplicationContext application = SpringApplication.run(AppConsumer.class, args);
			Environment env = application.getEnvironment();
			String ip = InetAddress.getLocalHost().getHostAddress();
			String port = env.getProperty("server.port");
			String path = env.getProperty("server.servlet.context-path");
			String hj = env.getProperty("spring.profiles.active");
			log.info("\n----------------------------------------------------------\n\t" +
					"Application yangbuyiCloud is running! Access URLs:\n\t" +
					"Local: \t\thttp://localhost:" + port + path + "/\n\t" +
					"当前配置环境: \t\t当前环境为:" + hj + "/\n\t" +
					"----------------------------------------------------------");
	  }

	  /**
	   * @Description: 杨不易个人网址:http://yangbuyi.top
	   * 功能描述:  @LoadBalanced 让rest 拥有负载均衡的能力
	   * @Param: @RestTemplate http请求服务
	   * @return:
	   * @Author: TeouBle
	   * @Date: 2020/8/16 20:58
	   */
	  @Bean
	  @LoadBalanced
	  public RestTemplate restTemplate() {
			return new RestTemplate();
	  }


}

```



####  3.在启动类上添加注解

#### #### ####  nacos 服务发现 客户端 @EnableDiscoveryClient



####  4.在配置文件添加添加配置

```
server:
  port: 5000
  servlet:
    context-path: /cloud-user
spring:
  application:
    name: consumer-user
  cloud:
    nacos:
      discovery:
        #### nacos服务的地址 不要加http
        ####  可以写一个地址 集群会自动获取服务 但是为了安全起见还是全部写上
        ####          server-addr: 127.0.0.1:8849,127.0.0.1:8850,127.0.0.1:8851
        ####  使用nginx反向代理
        server-addr: 192.168.43.204:80
        register-enabled: true
    ####    server-addr: localhost:8850


name: 默认环境

```

#### ####  上面看不懂的话也可直接写这样子的

```
server:
  port: 5000
  servlet:
    context-path: /cloud-user
spring:
  application:
    name: user-client
####  将当前工程注册到nacos上面
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848 #### nacos服务的地址 不要加http
```





####  5.启动工程后, 在nacos当中查询服务列表

![](https://img2020.cnblogs.com/blog/1735255/202008/1735255-20200816210312843-1417314109.png)





####  nacos服务没有下载的去观看上一章节的nacos服务安装和错误解决

####  https://www.cnblogs.com/Yangbuyi/p/13479767.html



####  6.使用相同方式 把provide服务注册到nacos上

#### ####  创建启动类

```

package top.yangbuyi;

import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;
import org.springframework.cloud.client.loadbalancer.LoadBalanced;
import org.springframework.context.ConfigurableApplicationContext;
import org.springframework.context.annotation.Bean;
import org.springframework.core.env.Environment;
import org.springframework.web.client.RestTemplate;

import java.net.InetAddress;
import java.net.UnknownHostException;

/**
 * @description: 杨不易网站:www.yangbuyi.top
 * @program: springcloudalibabaparent
 * @ClassName: top.yangbuyi.AppConsumer
 * @create: 2020-08-16 20:57
 * @author: yangbuyi
 * @since： JDK1.8
 * @AppConsumer:
 **/
@SpringBootApplication
@Slf4j
// nacos 服务发现 客户端
@EnableDiscoveryClient

public class AppProvide  {

	  public static void main(String[] args) throws UnknownHostException {
			ConfigurableApplicationContext application = SpringApplication.run(AppProvide.class, args);
			Environment env = application.getEnvironment();
			String ip = InetAddress.getLocalHost().getHostAddress();
			String port = env.getProperty("server.port");
			String path = env.getProperty("server.servlet.context-path");
			String hj = env.getProperty("spring.profiles.active");
			log.info("\n----------------------------------------------------------\n\t" +
					"Application yangbuyiCloud is running! Access URLs:\n\t" +
					"Local: \t\thttp://localhost:" + port + path + "/\n\t" +
					"当前配置环境: \t\t当前环境为:" + hj + "/\n\t" +
					"----------------------------------------------------------");
	  }

	  /**
	   * @Description: 杨不易个人网址:http://yangbuyi.top
	   * 功能描述:  @LoadBalanced 让rest 拥有负载均衡的能力
	   * @Param: @RestTemplate http请求服务
	   * @return:
	   * @Author: TeouBle
	   * @Date: 2020/8/16 20:58
	   */
	  @Bean
	  @LoadBalanced
	  public RestTemplate restTemplate() {
			return new RestTemplate();
	  }


}



```

####  创建yml配置

```

server:
  port: 7000
  servlet:
    context-path: /cloud-yby
spring:
  application:
    name: provide-goods ####  服务名称  服务ID
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8085 ####  nacos服务地址 单个服务

name: 默认环境

```



####  7. 启动两个服务  consumer和 provide  去nacos查看是否有

![](https://img2020.cnblogs.com/blog/1735255/202008/1735255-20200816212408695-1541526077.png)



####  8. 在consumer工程中通过服务发现调用provide  工程

![image-20200816212647706](C:\Users\16927\AppData\Roaming\Typora\typora-user-images\image-20200816212647706.png)



![image-20200816212716067](C:\Users\16927\AppData\Roaming\Typora\typora-user-images\image-20200816212716067.png)



####  到此即可通过 consumer访问provide工程当中的方法啦

####  nacos有问题请评论区联系我

####  完结  下一章节 nacos集群







